<div class="username px-3 px-sm-4">
  <button mat-icon-button [matMenuTriggerFor]="menu">
    <mat-icon>account_circle</mat-icon>
  </button>
  <span>{{username.toUpperCase()}}</span>
  <mat-menu #menu="matMenu">
    <button mat-menu-item (click)="changePassword()">Cambiar contraseña</button>
    <button mat-menu-item (click)="logout()">Cerrar sesión</button>
  </mat-menu>
</div>

<div class="container">

  <mat-card class="mx-auto">

    <mat-tab-group>

      <mat-tab class="example-small-box mat-elevation-z4 " label="Comentarios">

        <table mat-table [dataSource]="commentsDataSource" multiTemplateDataRows class="mat-elevation-z8">

          <ng-container matColumnDef="email">
            <th mat-header-cell *matHeaderCellDef>Correo electrónico</th>
            <td mat-cell *matCellDef="let report">{{report.email}}</td>
          </ng-container>

          <ng-container matColumnDef="subject">
            <th mat-header-cell *matHeaderCellDef>Asunto</th>
            <td mat-cell *matCellDef="let report">{{report.subject}}</td>
          </ng-container>

          <ng-container matColumnDef="creationDate">
            <th mat-header-cell *matHeaderCellDef>Fecha</th>
            <td mat-cell *matCellDef="let report">{{report.creationDate | date: 'dd/MM/yy hh:mm a'}}</td>
          </ng-container>

          <ng-container matColumnDef="read">
            <th mat-header-cell *matHeaderCellDef>Leído</th>
            <td mat-cell *matCellDef="let report">
              <mat-icon *ngIf="report.isRead">done</mat-icon>
            </td>
          </ng-container>

          <ng-container matColumnDef="expandedDetail">
            <td mat-cell *matCellDef="let report" [attr.colspan]="displayedColumns.length">
              <div class="example-element-detail"
                   [@detailExpand]="report == expandedReport ? 'expanded' : 'collapsed'">
                <div class="example-element-diagram">
                  <div class="report-subject">{{report.subject}}</div>
                  <div class="example-element-symbol">{{report.email}}</div>
                  <div class="example-element-name">{{report.creationDate | date: 'dd/MM/yy hh:mm a'}}</div>
                  <button mat-flat-button color="white" *ngIf="!report.isRead; else read" (click)="setAsRead(report)">
                    Marcar
                    como leído
                  </button>
                  <ng-template #read>
                    <button mat-flat-button color="white" (click)="setAsNotRead(report)">Marcar como no leído</button>
                  </ng-template>
                </div>
                <div class="example-element-description">
                  {{report.description}}
                </div>
              </div>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let report; columns: displayedColumns;"
              class="example-element-row"
              [class.example-expanded-row]="expandedReport === report"
              (click)="expandedReport = expandedReport === report ? null : report">
          </tr>
          <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="example-detail-row"></tr>
        </table>

      </mat-tab>

      <mat-tab class="example-small-box mat-elevation-z4 " label="Errores">

        <table mat-table [dataSource]="errorsDataSource" multiTemplateDataRows class="mat-elevation-z8">

          <ng-container matColumnDef="email">
            <th mat-header-cell *matHeaderCellDef>Correo electrónico</th>
            <td mat-cell *matCellDef="let report">{{report.email}}</td>
          </ng-container>

          <ng-container matColumnDef="subject">
            <th mat-header-cell *matHeaderCellDef>Asunto</th>
            <td mat-cell *matCellDef="let report">{{report.subject}}</td>
          </ng-container>

          <ng-container matColumnDef="creationDate">
            <th mat-header-cell *matHeaderCellDef>Fecha</th>
            <td mat-cell *matCellDef="let report">{{report.creationDate | date: 'dd/MM/yy hh:mm a'}}</td>
          </ng-container>

          <ng-container matColumnDef="read">
            <th mat-header-cell *matHeaderCellDef>Leído</th>
            <td mat-cell *matCellDef="let report">
              <mat-icon *ngIf="report.isRead">done</mat-icon>
            </td>
          </ng-container>

          <ng-container matColumnDef="expandedDetail">
            <td mat-cell *matCellDef="let report" [attr.colspan]="displayedColumns.length">
              <div class="example-element-detail"
                   [@detailExpand]="report == expandedReport ? 'expanded' : 'collapsed'">
                <div class="example-element-diagram">
                  <div class="report-subject">{{report.subject}}</div>
                  <div class="example-element-symbol">{{report.email}}</div>
                  <div class="example-element-name">{{report.creationDate | date: 'dd/MM/yy hh:mm a'}}</div>
                  <button mat-flat-button color="white" *ngIf="!report.isRead; else read" (click)="setAsRead(report)">
                    Marcar
                    como leído
                  </button>
                  <ng-template #read>
                    <button mat-flat-button color="white" (click)="setAsNotRead(report)">Marcar como no leído</button>
                  </ng-template>
                </div>
                <div class="example-element-description">
                  {{report.description}}
                </div>
              </div>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let report; columns: displayedColumns;"
              class="example-element-row"
              [class.example-expanded-row]="expandedReport === report"
              (click)="expandedReport = expandedReport === report ? null : report">
          </tr>
          <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="example-detail-row"></tr>
        </table>

      </mat-tab>

    </mat-tab-group>

  </mat-card>

</div>
